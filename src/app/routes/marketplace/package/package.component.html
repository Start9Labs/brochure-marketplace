<div
  *ngIf="pkg$ | async as pkg; else loading"
  class="sm:pl-[34vw] md:pl-[28vw] lg:pl-[22vw] 2xl:pl-[280px] min-h-screen"
  [@tuiFadeIn]="getAnimation(speed)">
  <div class="grid grid-flow-row gap-8 justify-center">
    <button
      routerLink="/marketplace"
      tuiIconButton
      icon="tuiIconArrowLeftLarge"
      type="button"
      appearance="flat"
      class="m-2 md:my-8"></button>

    <ng-container *ngIf="pkg | empty; else show">
      <ng-container *ngIf="version$ | async as version">
        <h2 class="m-auto text-center">
          {{ pkgId }} version {{ version === '*' ? 'latest' : version }} not
          found in this registry
        </h2>
      </ng-container>
    </ng-container>

    <ng-template #show>
      <!-- <marketplace-package [pkg]="pkg"></marketplace-package> -->

      <div class="container mb-16">
        <!-- color background -->
        <!-- <div
          class="overflow-hidden absolute w-full h-full top-0 left-0 -z-50 rounded-3xl bg-black">
          <div
            class="absolute top-0 left-0 w-full h-full bg-center panel"></div>
          <img
            [src]="'data:image/png;base64,' + pkg.icon | trustUrl"
            class="absolute object-cover pointer-events-none w-[200%] h-[200%] max-w-[200%] blur-[100px] saturate-150"
            alt="{{ pkg.manifest.title }} Icon" />
        </div> -->
        <div class="mt-10 md:mt-0 flex flex-col items-center relative">
          <!-- icon -->
          <img
            [src]="'data:image/png;base64,' + pkg.icon | trustUrl"
            class="w-24 h-24 pointer-events-none absolute left-7 -top-9 rounded-full object-cover shadow-xl"
            alt="{{ pkg.manifest.title }} Icon"
            style="transform: none" />
          <!-- header -->
          <div
            class="flex flex-col h-fit w-[75vw] relative rounded-3xl pt-16 pb-10 px-8 shadow-xl">
            <div
              class="overflow-hidden absolute w-full h-full top-0 left-0 -z-50 rounded-3xl bg-black">
              <div
                class="absolute top-0 left-0 w-full h-full bg-center panel"></div>
              <img
                [src]="'data:image/png;base64,' + pkg.icon | trustUrl"
                class="absolute object-cover pointer-events-none w-[200%] h-[200%] max-w-[200%] blur-[100px] saturate-150"
                alt="{{ pkg.manifest.title }} Icon" />
            </div>
            <div class="my-3">
              <span
                class="block text-2xl font-medium text-zinc-50/90 line-clamp-1 mb-1"
                >{{ pkg.manifest.title }}</span
              ><span class="block text-zinc-50/70 h-11 line-clamp-2">{{
                pkg.manifest.description.short
              }}</span>
            </div>
            <div
              *ngIf="pkg.screenshots"
              tuiCarouselButtons
              class="flex items-center">
              <button
                tuiIconButton
                icon="tuiIconChevronLeftLarge"
                title="Previous"
                type="button"
                (click)="carousel.prev()"></button>
              <tui-carousel
                #carousel
                [itemsCount]="2"
                [(index)]="index"
                class="overflow-y-hidden overflow-x-scroll carousel">
                <ng-container
                  *ngFor="let item of pkg.screenshots; let i = index">
                  <div
                    *tuiItem
                    draggable="false"
                    [class.item_active]="i === index + 1"
                    class="rounded-lg md:rounded-xl object-cover p-2 border-2 border-zinc-700 bg-zinc-800 w-full">
                    <img
                      alt="Service Screenshot"
                      src="img/{{ item }}"
                      class="drop-shadow-xl" />
                  </div>
                </ng-container>
              </tui-carousel>
              <button
                tuiIconButton
                type="button"
                icon="tuiIconChevronRightLarge"
                title="Next"
                (click)="carousel.next()"></button>
            </div>
          </div>
        </div>
        <div class="mt-5 grid grid-cols-1 lg:grid-cols-12 gap-x-8">
          <!-- about -->
          <div class="lg:col-span-7 xl:col-span-8">
            <div
              class="rounded-3xl bg-gradient-to-r from-veronica/75 to-cyan/75 p-px shadow-l">
              <!-- <marketplace-about [pkg]="pkg"></marketplace-about> -->
              <div
                class="lg:col-span-5 xl:col-span-4 bg-zinc-800 rounded-3xl p-7">
                <!-- <marketplace-about [pkg]="pkg"></marketplace-about> -->
                <p class="tui-island__category">About</p>
                <p class="tui-island__paragraph">
                  {{ pkg.manifest.description.long }}
                </p>
                <div *ngIf="!(pkg.manifest.dependencies | empty)" class="pt-4">
                  <p class="tui-island__category">Dependencies</p>
                  <!-- <marketplace-dependencies
                *ngIf="!(pkg.manifest.dependencies | empty)"
                [pkg]="pkg"></marketplace-dependencies> -->
                  <div class="flex flex-col md:flex-row-auto gap-3">
                    <div
                      *ngFor="let dep of pkg.manifest.dependencies | keyvalue">
                      <a [routerLink]="['/marketplace', dep.key]">
                        <div
                          class="bg-zinc-700 rounded-3xl py-3 px-5 gap-2 shadow-xl">
                          <div class="flex items-center gap-6">
                            <img
                              [src]="
                                'data:image/png;base64,' +
                                  pkg['dependency-metadata'][dep.key].icon
                                  | trustUrl
                              "
                              class="w-16 pointer-events-none rounded-full object-cover shadow-xl"
                              alt="{{
                                pkg['dependency-metadata'][dep.key].title
                              }} Icon" />
                            <div class="mt-3">
                              <div
                                class="flex flex-wrap items-center gap-1 mb-1">
                                <span
                                  class="block text-lg font-medium text-zinc-50/90 line-clamp-1"
                                  >{{
                                    pkg['dependency-metadata'][dep.key].title
                                  }}</span
                                >
                                <p>
                                  <ng-container
                                    [ngSwitch]="dep.value.requirement.type">
                                    <span *ngSwitchCase="'required'"
                                      >(required)</span
                                    >
                                    <span *ngSwitchCase="'opt-out'"
                                      >(required by default)</span
                                    >
                                    <span *ngSwitchCase="'opt-in'"
                                      >(optional)</span
                                    >
                                  </ng-container>
                                </p>
                              </div>
                              <span class="text-zinc-50/70 h-11 line-clamp-2">{{
                                dep.value.description
                              }}</span>
                            </div>
                          </div>
                        </div>
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- additional info-->
          <div class="lg:col-span-5 xl:col-span-4 mt-6 lg:mt-0">
            <div
              class="rounded-3xl bg-gradient-to-r from-lime/75 to-tangerine/75 p-px shadow-lg">
              <div class="bg-zinc-800 rounded-3xl p-7">
                <p class="tui-island__category">Information</p>
                <!-- <marketplace-additional
                  class="additional"
                  [pkg]="pkg"
                  (version)="version$.next($event)"></marketplace-additional> -->
                <div class="grid grid-flow-row">
                  <a
                    *ngIf="pkg.manifest['marketing-site'] as url"
                    href="url"
                    target="_blank"
                    rel="noreferrer"
                    class="text-veronica flex gap-1"
                    ><p>Marketing Site</p>
                    <img
                      alt="Open Icon"
                      class="transition block opacity-70 invert w-4"
                      style="color: transparent"
                      src="svg/open-outline.svg" />
                  </a>
                </div>
              </div>
            </div>
          </div>
          <!-- release notes -->
          <div class="lg:col-span-7 xl:col-span-8 mt-6">
            <div
              class="rounded-3xl bg-gradient-to-r from-cyan/75 to-lime/75 p-px shadow-lg">
              <div class="bg-zinc-800 rounded-3xl p-7">
                <p
                  *ngIf="pkg['published-at'] as published"
                  class="tui-island__category">
                  Latest Release - {{ published | date : 'medium' }}
                </p>
                <h3 class="tui-island__title">
                  What's new in <b>{{ pkg.manifest.version }}</b>
                </h3>
                <p
                  class="tui-island__paragraph"
                  [innerHTML]="pkg.manifest['release-notes']"></p>
                <button
                  tuiButton
                  type="button"
                  appearance="secondary"
                  size="m"
                  class="mt-3">
                  Past release notes
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-template>
  </div>
</div>

<ng-template #loading>
  <text-spinner text="Loading Package"></text-spinner>
</ng-template>
