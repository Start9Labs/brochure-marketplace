<marketplace-header
  [store]="store$ | async"
  [alt]="alternative$ | async"
  [(query)]="query"
  [(category)]="category"></marketplace-header>

<!-- main content -->
<div
  class="sm:pl-[34vw] md:pl-[28vw] lg:pl-[22vw] 2xl:pl-[280px] min-h-screen flex flex-col justify-between overflow-auto scroll-smooth">
  <main
    class="pt-20 sm:pt-3 md:pb-10 md:px-8 scroll-smooth"
    *ngIf="store$ | async as store; else loading">
    <div class="mt-8 px-6 mb-10">
      <h1 class="text-4xl sm:text-5xl font-bold text-zinc-50/80 pb-6">
        {{ category | titlecase }}
      </h1>
    </div>
    <section
      class="mt-10"
      *ngIf="store.packages | filterPackages : query : category as filtered">
      <ul
        *ngIf="filtered.length; else categoryEmpty"
        class="px-6 md:px-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-16"
        [@itemAnimation]="filtered.length">
        <li #myElement *ngFor="let pkg of filtered">
          <div class="items-center gap-3 h-full">
            <a [routerLink]="['/marketplace', pkg.manifest.id]">
              <div
                #shinyBox
                (mousemove)="shinyHover($event)"
                class="flex flex-col h-full relative rounded-3xl pt-20 pb-10 px-8 gap-4 shadow-xl hover:scale-90 transition duration-500 ease-in-out">
                <div
                  class="overflow-hidden absolute w-full h-full top-0 left-0 -z-50 rounded-3xl bg-black">
                  <div
                    class="absolute top-0 left-0 w-full h-full bg-center panel"></div>
                  <img
                    [src]="'data:image/png;base64,' + pkg.icon | trustUrl"
                    class="absolute object-cover pointer-events-none w-[200%] h-[200%] max-w-[200%] blur-[100px] saturate-150"
                    alt="{{ pkg.manifest.title }} Icon" />
                </div>
                <img
                  [src]="'data:image/png;base64,' + pkg.icon | trustUrl"
                  class="w-[5.5rem] h-[5.5rem] pointer-events-none absolute -top-10 rounded-full object-cover shadow-xl"
                  alt="{{ pkg.manifest.title }} Icon"
                  style="transform: none" />
                <div class="mt-3">
                  <span
                    class="block text-2xl font-medium text-zinc-50/90 line-clamp-1 mb-1"
                    >{{ pkg.manifest.title }}</span
                  ><span class="block text-zinc-50/70 h-11 line-clamp-2">{{
                    pkg.manifest.description.short
                  }}</span>
                </div>
              </div>
            </a>
          </div>
        </li>
      </ul>
      <ng-template #categoryEmpty>
        <p class="px-6">No services in this category</p>
      </ng-template>
    </section>
  </main>
  <ng-template #loading>
    <marketplace-skeleton></marketplace-skeleton>
  </ng-template>
</div>
